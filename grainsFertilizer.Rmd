---
title: "Investigating the Effect of Fertilizer on Grain Yieldage"
author: "Tejas Guha"
date: "June 25, 2018"
output: slidy_presentation
---


```{r echo=FALSE, message=FALSE, warning=FALSE, width = 100, height = 100 }
library(plotly)
library(tidyr)
actualData = read.csv("D:\\r\\data_products\\WDI_csv\\WDIData.csv")
countryData = read.csv("D:\\r\\data_products\\WDI_csv\\WDICountry.csv")
countryData = countryData[which(countryData$Region != ""),]
countryData = countryData[order(countryData$Short.Name),]
actualData = actualData[which(actualData$Country.Code %in% countryData$ï..Country.Code),]
cerealProduction = actualData[which(actualData$Indicator.Code == "AG.YLD.CREL.KG"), c(1:2,47:59)]
cerealProduction = gather(cerealProduction, "Year", "Grains", 3:15)
fertilizer = actualData[which(actualData$Indicator.Code == "AG.CON.FERT.ZS"), c(1:2, 47:59)]
fertilizer = gather(fertilizer, "Year", "Fertilizer", 3:15)
data = merge(fertilizer, cerealProduction, by=c("ï..Country.Name", "Country.Code", "Year"))
names(data) = c("Short.Name", "Country.Code", "Year", "Fertilizer","Grains")
data$Year = as.numeric(lapply(data$Year, function(x){return(substring(toString(x), 2))}))
data = merge(data, countryData[,c(2,8)], by="Short.Name")
data=data[is.na(data$Grains)==FALSE,]
data=data[is.na(data$Fertilizer)==FALSE,]
plotList = list()
for (e in 2:8){
  x =  list(range=c(0,2500), title="", showgrid=FALSE)
  y = list(range=c(0, 20000), title="", showgrid=FALSE)
  region = levels(data$Region)[e]
  regionData = data[data$Region==region,]
  n = length(regionData$Fertilizer)
  test = sort(runif(min=0, max=2500, n))
  plotList[[e-1]] = plot_ly(data=regionData, x = ~Fertilizer, y=~Grains, frame= ~Year, text=~Short.Name,  color=~Region, hoverinfo="x+y+text", type="scatter", mode="markers") %>% 
    layout(xaxis=x,yaxis=y) %>% 
    add_lines(text="Prediction", y=~fitted(loess(Grains ~ Fertilizer, smooth=0.25)), line=list(color="rgb(0,0,0)", dash="dot", width=2),showlegend=FALSE) %>% 
    animation_opts(frame = 3000, transition = 3000, easing = "linear", redraw = FALSE, mode = "next")
}
p = subplot(plotList, nrows = 4, shareY = TRUE, titleX=FALSE, titleY = FALSE) %>% layout(title="Kilograms of Fertilizer per Hectare on the Grain yield in Kilograms per Hectare", width = 1500, height = 600)
p
```



